<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripMate - Advanced Travel Planner</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #6a4cff;
            --primary-light: #8a6dff;
            --secondary: #5a3dff;
            --accent: #ff6b6b;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #fffefc 0%, #fdfdf0 100%); /* pale white-yellowish */
        color: var(--dark);
        padding-top: 80px;
        min-height:100vh;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            padding: 15px 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-icon {
            font-size: 1.8rem;
            animation: float 3s ease-in-out infinite;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
            margin: 0;
            padding: 0;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 5px 0;
        }

        nav a:hover {
            color: #ffd700;
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #ffd700;
            transition: width 0.3s ease;
        }

        nav a:hover::after {
            width: 100%;
        }

        .user-dropdown {
            position: relative;
            display: flex;
            align-items: center;
        }

        .user-icon {
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .user-icon:hover {
            transform: scale(1.1);
        }

        .user-icon img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .user-icon:hover img {
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 60px;
            background-color: white;
            min-width: 220px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            z-index: 101;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-content a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            text-decoration: none;
            color: var(--dark);
            border-bottom: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .dropdown-content a:hover {
            background-color: var(--light-gray);
            padding-left: 20px;
        }

        .dropdown-content a i {
            width: 20px;
            text-align: center;
            color: var(--primary);
        }

        .dropdown-content .logout-link {
            color: var(--warning);
        }

        .dropdown-content .logout-link:hover {
            background-color: rgba(247, 37, 133, 0.1);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: rgba(82, 1, 117, 0.982);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(83, 2, 2, 0.1);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .booking-services {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1000;
        }

        .booking-dropdown {
            position: relative;
            display: inline-block;
        }

       .booking-btn {
    background: linear-gradient(135deg, #6603d0, #0247be, #c40276); /* purple → blue → pink */
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    box-shadow: 0 4px 15px rgba(255, 107, 255, 0.3); /* soft pinkish glow */
    transition: all 0.3s ease;
}

.booking-btn:hover {
    background: linear-gradient(135deg, #022f7d, #a80165, #5c03bb); /* reversed gradient for hover */
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 107, 255, 0.4);
}

        .booking-content {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            min-width: 200px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .booking-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background 0.3s ease;
        }

        .booking-content a:hover {
            background: #f8f9fa;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .map-section {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .mood-option {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .mood-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .mood-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .location-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .location-btn {
            flex: 1;
            padding: 10px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .location-btn:hover {
            background: #218838;
        }

        .location-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        #map {
            height: 1130px;
            width: 100%;
        }

        .map-info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 14px;
        }

        .travel-plan {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .plan-day {
            margin-bottom: 30px;
            padding: 20px;
            border-left: 4px solid #667eea;
            background: #f8f9ff;
            border-radius: 0 10px 10px 0;
        }

        .plan-day h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .activity {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .activity-time {
            font-weight: 600;
            color: #28a745;
            margin-bottom: 5px;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .activity-description {
            color: #666;
            line-height: 1.5;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .distance-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .distance-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .distance-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .distance-item {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .distance-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1976d2;
        }

        .distance-label {
            font-size: 0.9rem;
            color: #666;
        }
        /* Additional Services Section */
        .additional-services {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .services-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .service-btn {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .service-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .service-dropdown {
            display: none;
            grid-column: 1 / -1;
            background: #f8f9ff;
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
        }

        .service-dropdown.active {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .service-link {
            display: block;
            padding: 10px;
            background: white;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .service-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        /* Footer Styles */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 80px 0 30px;
            position: relative;
            margin-top: 80px;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .footer-logo h2 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .footer-logo-icon {
            font-size: 1.8rem;
            color: var(--accent);
        }

        .footer-about p {
            margin-bottom: 20px;
            color: #ccc;
            line-height: 1.6;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: var(--primary);
            transform: translateY(-3px);
        }

        .footer-links h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-links h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent);
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: white;
            padding-left: 5px;
        }

        .footer-links a i {
            font-size: 0.8rem;
        }

        .footer-newsletter h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-newsletter h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background: var(--accent);
        }

        .footer-newsletter p {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .newsletter-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .newsletter-form input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .newsletter-form input::placeholder {
            color: #ccc;
        }

        .newsletter-form button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            background: var(--primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .newsletter-form button:hover {
            background: var(--primary-light);
        }

        .footer-bottom {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 40px;
            color: #ccc;
        }

        .footer-bottom a {
            color: var(--accent);
            text-decoration: none;
        }

        .footer-bottom a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            #map {
                height: 500px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 768px) {
            nav ul {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .mood-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .footer-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .mood-grid {
                grid-template-columns: 1fr;
            }
            
            .location-controls {
                flex-direction: column;
            }
        }

/* print-speak buttons */
        .ai-toolbar-btn {
  background: linear-gradient(135deg, #ff6b6b, #ff9a76, #fcb69f);
  color: white;
  border: none;
  padding: 12px 18px;
  margin: 5px;
  border-radius: 25px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
}

.ai-toolbar-btn:hover {
  background: linear-gradient(135deg, #a0522d, #8b4513); /* brownish shade */
  transform: translateY(-2px);
}
/* Add these new styles for markdown content */
        .ai-itinerary h2 {
            color: #6a4cff;
            background: linear-gradient(135deg, #f0f0ff 0%, #e6e6ff 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 25px 0 15px 0;
            border-left: 5px solid #6a4cff;
            font-size: 1.5rem;
            box-shadow: 0 4px 6px rgba(106, 76, 255, 0.1);
        }
        
        .ai-itinerary h3 {
            color: #5a3dff;
            margin: 20px 0 10px 0;
            font-size: 1.3rem;
            padding-bottom: 5px;
            border-bottom: 2px solid #f0f0ff;
        }
        
        .ai-itinerary strong {
            color: #5a3dff;
            font-weight: 600;
        }
        
        .ai-itinerary em {
            color: #6c757d;
            font-style: italic;
        }
        
        .ai-itinerary ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        
        .ai-itinerary li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .highlight {
            background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

    </style>
</head>
<body>
    <!--Header-->
    <header>
    <div class="header-container">
      <div class="logo">
        <span class="logo-icon">✈️</span>
        <h1>TripMate</h1>
      </div>
      
      <button class="mobile-menu-btn" id="mobileMenuButton">
        <i class="fas fa-bars"></i>
      </button>
      
      <nav>
        <ul id="navMenu">
          <li><a href="index.html">Home</a></li>
          <li><a href="destinations.html">Destinations</a></li>
          <li><a href="destinations.html">Collections</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="dev.html">Contact</a></li>
        </ul>
      </nav>
      
      <div class="user-dropdown">
        <div class="user-icon" id="userDropdownButton">
          <img src="static/images/userprofile.jpg" alt="User Profile">
        </div>
        <div id="dropdownMenu" class="dropdown-content">
          <a href="profile.html"><i class="fas fa-user-circle"></i> My Profile</a>
          <a href="trips.html"><i class="fas fa-suitcase"></i> My Trips</a>
          <a href="feedback.html"><i class="fas fa-comments"></i> Reviews & Feedback</a>
          <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
          <a href="#" id="logoutButton" class="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </div>
    </div>
  </header>
  <!-- Main Container -->
   <div class="container">
   <div class="header">
            <h1><i class="fas fa-map-marked-alt"></i> TripMate </h1>
            <p>Your AI-Powered Travel Companion with Real-Time Navigation</p>
        </div>
   
        <!-- Booking Services Dropdown -->
        <div class="booking-services">
            <div class="booking-dropdown">
                <button class="booking-btn"><b>Pick Other Services</b></button>
                <div class="booking-content">
                    <a href="https://www.zomato.com" target="_blank">Order Food</a>
                    <a href="https://www.bookmyshow.com" target="_blank">Get Entertained</a>
                    <a href="https://www.uber.com" target="_blank">Hire Ride</a>
                    <a href="#" id="other-services-btn">Others</a>
                    <div id="other-services-dropdown" class="service-dropdown">
                        <a href="https://www.swiggy.com" target="_blank" class="service-link">Swiggy</a>
                        <a href="https://www.uber.com" target="_blank" class="service-link">Uber</a>
                        <a href="https://www.olacabs.com" target="_blank" class="service-link">Ola</a>
                        <a href="https://www.makemytrip.com" target="_blank" class="service-link">MakeMyTrip</a>
                        <a href="https://chat.openai.com" target="_blank" class="service-link">ChatGPT</a>
                        <a href="https://www.google.com/travel" target="_blank" class="service-link">Google Travel</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="form-section">
                <h2><i class="fas fa-route"></i> Plan Your Journey</h2>
                
                <div class="location-controls">
                    <button class="location-btn" onclick="getCurrentLocation()" id="locationBtn">
                        <i class="fas fa-crosshairs"></i> Use Current Location
                    </button>
                    <button class="location-btn" onclick="startNavigation()" id="navBtn" disabled>
                        <i class="fas fa-navigation"></i> Start Navigation
                    </button>
                </div>

                <form id="travelForm">
                    <div class="form-group">
                        <label for="origin"><i class="fas fa-map-marker-alt"></i> From</label>
                        <input type="text" id="origin" name="origin" placeholder="Enter departure city" required>
                    </div>

                    <div class="form-group">
                        <label for="destination"><i class="fas fa-flag-checkered"></i> To</label>
                        <input type="text" id="destination" name="destination" placeholder="Enter destination city" required>
                    </div>

                    <div class="form-group">
                        <label for="startDate"><i class="fas fa-calendar-alt"></i> Start Date</label>
                        <input type="date" id="startDate" name="startDate" required>
                    </div>

                    <div class="form-group">
                        <label for="endDate"><i class="fas fa-calendar-check"></i> End Date</label>
                        <input type="date" id="endDate" name="endDate" required>
                    </div>

                    <div class="form-group">
                        <label for="budget"><i class="fas fa-dollar-sign"></i> Budget </label>
                        <input type="number" id="budget" name="budget" min="1" placeholder="Enter your budget" required>
                    </div>

                    <div class="form-group">
                        <label for="transport"><i class="fas fa-car"></i> Transport Mode</label>
                        <select id="transport" name="transport" required>
                            <option value="">Select transport</option>
                            <option value="flight">Flight</option>
                            <option value="train">Train</option>
                            <option value="bus">Bus</option>
                            <option value="car">Car</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-heart"></i> Travel Mood</label>
                        <div class="mood-grid">
                            <div class="mood-option" data-mood="adventure">
                                <i class="fas fa-mountain"></i><br>Adventure
                            </div>
                            <div class="mood-option" data-mood="relaxing">
                                <i class="fas fa-spa"></i><br>Relaxing
                            </div>
                            <div class="mood-option" data-mood="cultural">
                                <i class="fas fa-landmark"></i><br>Cultural
                            </div>
                            <div class="mood-option" data-mood="foodie">
                                <i class="fas fa-utensils"></i><br>Foodie
                            </div>
                            <div class="mood-option" data-mood="romantic">
                                <i class="fas fa-heart"></i><br>Romantic
                            </div>
                            <div class="mood-option" data-mood="family">
                                <i class="fas fa-users"></i><br>Family
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="preferences"><i class="fas fa-list"></i> Additional Preferences</label>
                        <textarea id="preferences" name="preferences" rows="3" placeholder="Any specific preferences or requirements..."></textarea>
                    </div>

                    <button type="submit" class="generate-btn" id="generateBtn">
                        <i class="fas fa-magic"></i> Generate Travel Plan
                    </button>
                </form>
            </div>

            <div class="map-section">
                <div class="map-info" id="mapInfo">
                    <strong>Interactive Map</strong><br>
                    <span id="mapStatus">Enter locations to see route</span>
                    <div id="routing-instructions" style="max-height:200px; overflow-y:auto;"></div>
                </div>
                <div id="map"></div>
            </div>
        </div>

        <div id="distanceInfo" class="distance-info" style="display: none;">
            <h4><i class="fas fa-route"></i> Route Information</h4>
            <div class="distance-details">
                <div class="distance-item">
                    <div class="distance-value" id="totalDistance">-</div>
                    <div class="distance-label">Total Distance</div>
                </div>
                <div class="distance-item">
                    <div class="distance-value" id="estimatedTime">-</div>
                    <div class="distance-label">Estimated Time</div>
                </div>
                <div class="distance-item">
                    <div class="distance-value" id="routeType">-</div>
                    <div class="distance-label">Route Type</div>
                </div>
            </div>
        </div>

        <div id="travelPlan" class="travel-plan" style="display: none;">
            <h2><i class="fas fa-clipboard-list"></i> Your Detailed Travel Plan</h2>
            <p style="color:#666; font-size:0.9rem;">
Your AI-powered itinerary is shown first. If no AI plan is generated, hakuna matata — we’ve got you covered with our essential overview.
</p>

            <div id="planContent"></div>

<!-- AI Plan Toolbar -->
<div id="aiPlanToolbar" style="display:none; margin-top:20px; text-align:center;">
  <button class="ai-toolbar-btn" onclick="listenPlan()">🔊 Listen</button>
  <button class="ai-toolbar-btn" onclick="printPlan()">🖨️ Print</button>
  <button class="ai-toolbar-btn" onclick="savePlan()">💾 Save</button>
  <button class="ai-toolbar-btn" onclick="mapView()">🗺️ Map View</button>
</div>

        </div>
    </div>
     <div class="additional-services">
            <h3 class="services-title">Additional Services</h3>
            <div class="services-grid">
                <button class="service-btn" onclick="window.open('https://www.zomato.com', '_blank')">
                    <i class="fas fa-utensils"></i> Order Food
                </button>
                <button class="service-btn" onclick="window.open('https://www.bookmyshow.com', '_blank')">
                    <i class="fas fa-ticket-alt"></i> Get Entertained
                </button>
                <button class="service-btn" onclick="window.open('https://www.rapido.com', '_blank')">
                    <i class="fas fa-motorcycle"></i> Hire Ride
                </button>
                <button class="service-btn" id="toggle-services-btn">
                    <i class="fas fa-ellipsis-h"></i> Other Services
                </button>
            </div>
            <div class="service-dropdown" id="services-dropdown">
                <a href="https://www.swiggy.com" target="_blank" class="service-link">Swiggy</a>
                <a href="https://www.uber.com" target="_blank" class="service-link">Uber</a>
                <a href="https://www.olacabs.com" target="_blank" class="service-link">Ola</a>
                <a href="https://www.makemytrip.com" target="_blank" class="service-link">MakeMyTrip</a>
                <a href="https://chat.openai.com" target="_blank" class="service-link">ChatGPT</a>
                <a href="https://www.google.com/travel" target="_blank" class="service-link">Google Travel</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-about">
                <div class="footer-logo">
                    <span class="footer-logo-icon"><i class="fas fa-route"></i></span>
                    <h2>TripMate AI</h2>
                </div>
                <p>Plan your perfect trips with AI-powered itinerary generation, smart recommendations, and seamless navigation.</p>
                <div class="social-links">
            <a href="https://www.linkedin.com/in/akshitha-sai-1931-babbili" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="https://x.com/AkshithaSa73999"><i class="fab fa-twitter"></i></a>
            <a href="https://github.com/Akshitha-Sai" target="_blank"><i class="fab fa-github"></i></a>
          <a href="mailto:akshithasai19@gmail.com"><i class="fas fa-envelope"></i></a>
          </div>
            </div>
            <div class="footer-links">
                <h3>Explore</h3>
                <ul>
                    <li><a href="main.html"><i class="fas fa-chevron-right"></i> Home</a></li>
                    <li><a href="dev.html"><i class="fas fa-chevron-right"></i> About Us</a></li>
                    <li><a href="about.html"><i class="fas fa-chevron-right"></i> Services</a></li>
                    <li><a href="destinations.html"><i class="fas fa-chevron-right"></i> Destinations</a></li>
                    <li><a href="dev.html"><i class="fas fa-chevron-right"></i> Travel Blog</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="dev.html"><i class="fas fa-chevron-right"></i>Made with ❤️</a></li>
                    <li><a href="dev.html"><i class="fas fa-chevron-right"></i>Developer</a></li>
                    <li><a href="dev.html"><i class="fas fa-chevron-right"></i>Contact</a></li>
                    <li><a href="feedback.html"><i class="fas fa-chevron-right"></i>Feedback</a></li>
                    <li><a href="about.html"><i class="fas fa-chevron-right"></i>TripMate</a></li>
                </ul>
            </div>
            <div class="footer-newsletter">
                <h3>Newsletter</h3>
                <p>Subscribe to our newsletter for the latest travel updates and offers.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Your Email Address" required>
                    <button type="submit"><i class="fas fa-paper-plane"></i></button>
                </form>
                <p>Get the latest news and updates on travel destinations around the world.</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2023 TripMate AI. All rights reserved. | Designed with <i class="fas fa-heart" style="color: var(--accent);"></i> by <a href="dev.html">TripMate Team</a></p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script>

        function markdownToHtml(markdown) {
    if (!markdown) return '';
    
    // Replace headings
    let html = markdown.replace(/^## (.*$)/gim, '<h2 style="color: #6a4cff; margin: 20px 0 10px 0; border-bottom: 2px solid #f0f0ff; padding-bottom: 5px;">$1</h2>');
    html = html.replace(/^### (.*$)/gim, '<h3 style="color: #5a3dff; margin: 15px 0 8px 0;">$1</h3>');
    
    // Replace bold and italic
    html = html.replace(/\*\*(.*?)\*\*/gim, '<strong style="color: #5a3dff;">$1</strong>');
    html = html.replace(/\*(.*?)\*/gim, '<em style="color: #6c757d;">$1</em>');
    
    // Replace unordered lists
    html = html.replace(/^\* (.*$)/gim, '<li style="margin-bottom: 8px; line-height: 1.5;">$1</li>');
    html = html.replace(/(<li>.*<\/li>)/gim, '<ul style="padding-left: 20px; margin: 10px 0;">$1</ul>');
    
    // Replace line breaks
    html = html.replace(/\n/g, '<br>');
 
    // Remove any duplicate ul tags
    html = html.replace(/<\/ul><ul>/g, '');
    
    // Handle emojis (keep them as is)
    html = html.replace(/:(.*?):/g, '$1');
    
    return html;
}

        // Global variables
        let map;
        let routingControl;
        let currentLocationMarker;
        let userLocation = null;
        let selectedMood = '';
        let watchId = null;

        // Initialize map
        function initMap() {
            map = L.map('map').setView([40.7128, -74.0060], 4);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Add click event to map
            map.on('click', function(e) {
                console.log('Map clicked at:', e.latlng);
            });
        }

        // Set minimum date to today
        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
            document.getElementById('endDate').min = today;
        }

        // Validate dates
        function validateDates() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (startDate < today) {
                throw new Error('Start date cannot be in the past');
            }

            if (endDate < startDate) {
                throw new Error('End date must be after start date');
            }

            const daysDiff = (endDate - startDate) / (1000 * 60 * 60 * 24);
            if (daysDiff > 30) {
                throw new Error('Trip duration cannot exceed 30 days');
            }

            return Math.ceil(daysDiff) + 1;
        }

        // Validate budget
        function validateBudget(budget) {
            if (budget <= 0) {
                throw new Error('Budget must be greater than 0');
            }
            if (budget > 1000000) {
                throw new Error('Budget seems unrealistic. Please enter a reasonable amount');
            }
            return true;
        }

        // Geocode location
        async function geocodeLocation(location) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
                const data = await response.json();
                
                if (data.length === 0) {
                    throw new Error(`Location "${location}" not found. Please check spelling and try again.`);
                }
                
                return {
                    lat: parseFloat(data[0].lat),
                    lng: parseFloat(data[0].lon),
                    display_name: data[0].display_name
                };
            } catch (error) {
                console.error('Geocoding error:', error);
                throw new Error(`Unable to find location: ${location}`);
            }
        }

        // Calculate distance between two points
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Update route on map
        async function updateRoute(origin, destination) {
            try {
                const originCoords = await geocodeLocation(origin);
                const destCoords = await geocodeLocation(destination);
                
                // Remove existing routing control
                if (routingControl) {
                    map.removeControl(routingControl);
                }

                // Add new routing control
                routingControl = L.Routing.control({
                    waypoints: [
                        L.latLng(originCoords.lat, originCoords.lng),
                        L.latLng(destCoords.lat, destCoords.lng)
                    ],
                    routeWhileDragging: true,
                    addWaypoints: false,
                    lineOptions: {           // 👈 added
                        styles: [{ color: 'red', weight: 5 }] 
                    },
                    show: true,
                    createMarker: function(i, waypoint, n) {
                        const marker = L.marker(waypoint.latLng, {
                            draggable: false
                        });
                        
                        if (i === 0) {
                            marker.bindPopup(`<strong>Origin:</strong><br>${originCoords.display_name}`);
                        } else {
                            marker.bindPopup(`<strong>Destination:</strong><br>${destCoords.display_name}`);
                        }
                        
                        return marker;
                    },
                    container: document.getElementById('routing-instructions') // 👈 added
                    
                }).on('routesfound', function(e) {
                    const routes = e.routes;
                    const summary = routes[0].summary;
                    
                    // Update distance info
                    document.getElementById('totalDistance').textContent = 
                        (summary.totalDistance / 1000).toFixed(1) + ' km';
                    document.getElementById('estimatedTime').textContent = 
                        Math.round(summary.totalTime / 60) + ' min';
                    document.getElementById('routeType').textContent = 'Driving';
                    document.getElementById('distanceInfo').style.display = 'block';
                    
                    // Update map status
                    document.getElementById('mapStatus').textContent = 
                        `Route: ${(summary.totalDistance / 1000).toFixed(1)} km, ${Math.round(summary.totalTime / 60)} min`;
                }).addTo(map);

                // Fit map to show both points
                const group = new L.featureGroup([
                    L.marker([originCoords.lat, originCoords.lng]),
                    L.marker([destCoords.lat, destCoords.lng])
                ]);
                map.fitBounds(group.getBounds().pad(0.1));

            } catch (error) {
                console.error('Route update error:', error);
                showError(error.message);
            }
        }

        // Get current location
        function getCurrentLocation() {
            const btn = document.getElementById('locationBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Getting Location...';

            if (!navigator.geolocation) {
                showError('Geolocation is not supported by this browser');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-crosshairs"></i> Use Current Location';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // Add current location marker
                    if (currentLocationMarker) {
                        map.removeLayer(currentLocationMarker);
                    }

                    currentLocationMarker = L.marker([userLocation.lat, userLocation.lng], {
                        icon: L.icon({
                            iconUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiIGZpbGw9IiM0Mjg1RjQiLz4KPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMyIgZmlsbD0id2hpdGUiLz4KPC9zdmc+',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(map);

                    // Reverse geocode to get address
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLocation.lat}&lon=${userLocation.lng}`);
                        const data = await response.json();
                        document.getElementById('origin').value = data.display_name.split(',')[0];
                        
                        currentLocationMarker.bindPopup(`<strong>Your Location:</strong><br>${data.display_name}`).openPopup();
                        
                        // Center map on current location
                        map.setView([userLocation.lat, userLocation.lng], 13);
                        
                        document.getElementById('navBtn').disabled = false;
                        document.getElementById('mapStatus').textContent = 'Current location detected';
                        
                    } catch (error) {
                        console.error('Reverse geocoding error:', error);
                        document.getElementById('origin').value = `${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}`;
                    }

                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-check"></i> Location Found';
                    setTimeout(() => {
                        btn.innerHTML = '<i class="fas fa-crosshairs"></i> Use Current Location';
                    }, 2000);
                },
                function(error) {
                    console.error(' Geolocation error:', error);
                    let errorMessage = 'Unable to get your location';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'Location access denied by user';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'Location information unavailable';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'Location request timed out';
                            break;
                    }
                    showError(errorMessage);
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-crosshairs"></i> Use Current Location';
                }
            );
        }

        // Start navigation
        function startNavigation() {
            if (!userLocation) {
                showError('Please get your current location first');
                return;
            }

            const destination = document.getElementById('destination').value;
            if (!destination) {
                showError('Please enter a destination');
                return;
            }

            // Start watching position for real-time updates
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }

            watchId = navigator.geolocation.watchPosition(
                function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // Update current location marker
                    if (currentLocationMarker) {
        currentLocationMarker.setLatLng([userLocation.lat, userLocation.lng]);
    }

            // 👇 Recalculate route dynamically from current location
            if (routingControl) {
                    const dest = document.getElementById('destination').value;
                    geocodeLocation(dest).then(destCoords => {
                    routingControl.setWaypoints([
                    L.latLng(userLocation.lat, userLocation.lng),
                    L.latLng(destCoords.lat, destCoords.lng)
                    ]);
             });
            }
            console.log('Position updated & route refreshed:', userLocation);

                },
                function(error) {
                    console.error('Position watch error:', error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );

            document.getElementById('navBtn').innerHTML = '<i class="fas fa-stop"></i> Stop Navigation';
            document.getElementById('navBtn').onclick = stopNavigation;
            document.getElementById('mapStatus').textContent = 'Navigation active - Real-time tracking';
        }

        // Stop navigation
        function stopNavigation() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }

            document.getElementById('navBtn').innerHTML = '<i class="fas fa-navigation"></i> Start Navigation';
            document.getElementById('navBtn').onclick = startNavigation;
            document.getElementById('mapStatus').textContent = 'Navigation stopped';
        }


        // Handle mood selection
        function handleMoodSelection() {
            document.querySelectorAll('.mood-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.mood-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedMood = this.dataset.mood;
                    console.log('Mood selected:', selectedMood);
                });
            });
        }

        // Toggle booking dropdown
        function toggleBookingDropdown() {
            const dropdown = document.getElementById('bookingDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('bookingDropdown');
            const button = document.querySelector('.booking-btn');
            
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Show error message
        function showError(message) {
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }

            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            
            const form = document.getElementById('travelForm');
            form.insertBefore(errorDiv, form.firstChild);

            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Generate detailed travel plan

        const GEMINI_API_KEY = "AIzaSyDDWl8RZOB8hQR0Sl10r2-oDnGbZGDXGy4"; // ⚠️ Replace with your key

async function generateGeminiItinerary(formData) {
    const prompt = `
    Generate a travel itinerary with the following details:
    - From: ${formData.origin}
    - To: ${formData.destination}
    - Start Date: ${formData.startDate}
    - End Date: ${formData.endDate}
    - Budget: ${formData.budget}
    - Transport Mode: ${formData.transport}
    - Travel Mood: ${selectedMood}
    - Additional Preferences: ${formData.preferences}

    Provide a detailed, day-wise itinerary with recommendations. Use emojis and structured formatting.
    `;

    try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ role: "user", parts: [{ text: prompt }] }]
            })
          }
        );

        const data = await response.json();
        if (data.candidates && data.candidates.length > 0) {
            return data.candidates[0].content.parts[0].text;
        } else {
return "No AI plan generated this time. No Worries — we’ll continue with our essential overview below.";
        }
    } catch (err) {
        console.error("Gemini API error:", err);
        return "⚠️ Error fetching AI itinerary. Showing default guidance instead.";
    }
}

        async function generateDetailedTravelPlan(formData, days) {
            const moodDescriptions = {
                adventure: 'thrilling outdoor activities, hiking, extreme sports, and adrenaline-pumping experiences',
                relaxing: 'spa treatments, peaceful beaches, meditation, wellness activities, and stress-free environments',
                cultural: 'museums, historical sites, local traditions, art galleries, and cultural immersion experiences',
                foodie: 'local cuisine, food tours, cooking classes, markets, and gastronomic adventures',
                romantic: 'intimate dining, sunset views, couples activities, and romantic atmospheres',
                family: 'kid-friendly attractions, educational activities, parks, and family bonding experiences'
            };

            const transportCosts = {
                flight: { base: 200, perKm: 0.15 },
                train: { base: 50, perKm: 0.08 },
                bus: { base: 30, perKm: 0.05 },
                car: { base: 100, perKm: 0.12 },
                mixed: { base: 150, perKm: 0.10 }
            };

            // Calculate estimated distance (simplified)
            let estimatedDistance = 500; // Default fallback
            try {
                const originCoords = await geocodeLocation(formData.origin);
                const destCoords = await geocodeLocation(formData.destination);
                estimatedDistance = calculateDistance(originCoords.lat, originCoords.lng, destCoords.lat, destCoords.lng);
            } catch (error) {
                console.error('Distance calculation error:', error);
            }

            const transport = transportCosts[formData.transport] || transportCosts.mixed;
            const transportCost = transport.base + (estimatedDistance * transport.perKm);
            const dailyBudget = (formData.budget - transportCost) / days;

            let plan = `
                <div class="plan-overview">
                    <h3><i class="fas fa-info-circle"></i> Trip Overview</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                            <strong>Duration:</strong> ${days} days<br>
                            <strong>Distance:</strong> ~${estimatedDistance.toFixed(0)} km
                        </div>
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                            <strong>Transport:</strong> ${formData.transport.charAt(0).toUpperCase() + formData.transport.slice(1)}<br>
                            <strong>Est. Cost:</strong> $${transportCost.toFixed(0)}
                        </div>
                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                            <strong>Daily Budget:</strong> $${dailyBudget.toFixed(0)}<br>
                            <strong>Mood:</strong> ${selectedMood.charAt(0).toUpperCase() + selectedMood.slice(1)}
                        </div>
                    </div>
                    <p style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                        <strong>Travel Focus:</strong> This itinerary is designed around ${moodDescriptions[selectedMood] || 'diverse experiences'}, 
                        ensuring each day offers memorable ${selectedMood} experiences within your budget of $${formData.budget}.
                    </p>
                </div>
            `;

            // Generate detailed daily plans
            for (let day = 1; day <= days; day++) {
                const currentDate = new Date(formData.startDate);
                currentDate.setDate(currentDate.getDate() + day - 1);
                const dateStr = currentDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });

                let dayActivities = '';
                
                if (day === 1) {
                    // Arrival day
                    dayActivities = `
                        <div class="activity">
                            <div class="activity-time">8:00 AM - 12:00 PM</div>
                            <div class="activity-title">Travel to ${formData.destination}</div>
                            <div class="activity-description">
                                Depart from ${formData.origin} via ${formData.transport}. 
                                ${formData.transport === 'flight' ? 'Arrive at airport 2 hours early for check-in and security.' : ''}
                                ${formData.transport === 'train' ? 'Enjoy scenic views during your train journey.' : ''}
                                ${formData.transport === 'car' ? 'Drive safely and take breaks every 2 hours.' : ''}
                                Estimated cost: $${(transportCost/2).toFixed(0)}
                            </div>
                        </div>
                        <div class="activity">
                            <div class="activity-time">1:00 PM - 3:00 PM</div>
                            <div class="activity-title">Check-in & Local Orientation</div>
                            <div class="activity-description">
                                Check into your accommodation and get oriented with the local area. 
                                Pick up maps, local SIM card if needed, and familiarize yourself with nearby amenities.
                                Budget: $${Math.min(dailyBudget * 0.3, 50).toFixed(0)} for accommodation setup.
                            </div>
                        </div>
                    `;
                } else if (day === days) {
                    // Departure day
                    dayActivities = `
                        <div class="activity">
                            <div class="activity-time">9:00 AM - 11:00 AM</div>
                            <div class="activity-title">Final Exploration & Souvenir Shopping</div>
                            <div class="activity-description">
                                Last-minute exploration of ${formData.destination}. Visit local markets for souvenirs and gifts.
                                Perfect time to grab those final photos and memories.
                                Budget: $${Math.min(dailyBudget * 0.4, 80).toFixed(0)} for souvenirs and final activities.
                            </div>
                        </div>
                        <div class="activity">
                            <div class="activity-time">12:00 PM - 4:00 PM</div>
                            <div class="activity-title">Check-out & Return Journey</div>
                            <div class="activity-description">
                                Check out of accommodation and begin return journey to ${formData.origin}.
                                ${formData.transport === 'flight' ? 'Arrive at airport 2 hours before departure.' : ''}
                                Remaining transport cost: $${(transportCost/2).toFixed(0)}
                            </div>
                        </div>
                    `;
                }

                // Generate mood-specific activities for middle days
                if (day > 1 && day < days) {
                    switch (selectedMood) {
                        case 'adventure':
                            dayActivities = `
                                <div class="activity">
                                    <div class="activity-time">7:00 AM - 9:00 AM</div>
                                    <div class="activity-title">Early Morning Hike</div>
                                    <div class="activity-description">
                                        Start with an invigorating hike to catch the sunrise. Popular trails near ${formData.destination} 
                                        offer breathtaking views and wildlife spotting opportunities. Bring water and snacks.
                                        Budget: $${Math.min(dailyBudget * 0.2, 30).toFixed(0)} for guide/equipment rental.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">11:00 AM - 4:00 PM</div>
                                    <div class="activity-title">Adventure Sports Experience</div>
                                    <div class="activity-description">
                                        Try local adventure activities like zip-lining, rock climbing, or water sports. 
                                        Professional instructors ensure safety while maximizing the thrill factor.
                                        Budget: $${Math.min(dailyBudget * 0.5, 120).toFixed(0)} for activities and equipment.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">6:00 PM - 8:00 PM</div>
                                    <div class="activity-title">Local Adventure Cuisine</div>
                                    <div class="activity-description">
                                        Dine at restaurants known for unique local dishes. Try regional specialties that reflect 
                                        the adventurous spirit of the area. Ask locals for hidden gem recommendations.
                                        Budget: $${Math.min(dailyBudget * 0.3, 50).toFixed(0)} for dinner and drinks.
                                    </div>
                                </div>
                            `;
                            break;
                        case 'cultural':
                            dayActivities = `
                                <div class="activity">
                                    <div class="activity-time">9:00 AM - 12:00 PM</div>
                                    <div class="activity-title">Historical Sites & Museums</div>
                                    <div class="activity-description">
                                        Explore the rich history of ${formData.destination} through its museums and historical landmarks. 
                                        Take guided tours to gain deeper insights into local culture and traditions.
                                        Budget: $${Math.min(dailyBudget * 0.3, 60).toFixed(0)} for entrance fees and guided tours.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">2:00 PM - 5:00 PM</div>
                                    <div class="activity-title">Cultural Workshop Experience</div>
                                    <div class="activity-description">
                                        Participate in hands-on cultural workshops like traditional crafts, cooking classes, 
                                        or local art forms. Create something meaningful to take home as a memory.
                                        Budget: $${Math.min(dailyBudget * 0.4, 80).toFixed(0)} for workshop fees and materials.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">7:00 PM - 9:00 PM</div>
                                    <div class="activity-title">Traditional Cultural Performance</div>
                                    <div class="activity-description">
                                        Attend local cultural performances, traditional music, or dance shows. 
                                        Many venues offer dinner packages with authentic regional cuisine.
                                        Budget: $${Math.min(dailyBudget * 0.3, 50).toFixed(0)} for tickets and dinner.
                                    </div>
                                </div>
                            `;
                            break;
                        case 'foodie':
                            dayActivities = `
                                <div class="activity">
                                    <div class="activity-time">8:00 AM - 10:00 AM</div>
                                    <div class="activity-title">Local Market Food Tour</div>
                                    <div class="activity-description">
                                        Start with a guided food tour through local markets. Sample fresh produce, 
                                        street food, and regional specialties while learning about local ingredients.
                                        Budget: $${Math.min(dailyBudget * 0.25, 40).toFixed(0)} for food tour and tastings.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">12:00 PM - 3:00 PM</div>
                                    <div class="activity-title">Cooking Class Experience</div>
                                    <div class="activity-description">
                                        Join a hands-on cooking class to learn traditional recipes from local chefs. 
                                        Master signature dishes you can recreate at home, including secret family recipes.
                                        Budget: $${Math.min(dailyBudget * 0.4, 80).toFixed(0)} for class and ingredients.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">7:00 PM - 9:30 PM</div>
                                    <div class="activity-title">Fine Dining Experience</div>
                                    <div class="activity-description">
                                        Indulge in a multi-course tasting menu at a renowned local restaurant. 
                                        Experience innovative takes on traditional cuisine paired with local wines or beverages.
                                        Budget: $${Math.min(dailyBudget * 0.35, 70).toFixed(0)} for fine dining experience.
                                    </div>
                                </div>
                            `;
                            break;
                        default:
                            dayActivities = `
                                <div class="activity">
                                    <div class="activity-time">9:00 AM - 12:00 PM</div>
                                    <div class="activity-title">City Exploration</div>
                                    <div class="activity-description">
                                        Explore the main attractions and landmarks of ${formData.destination}. 
                                        Take walking tours or use local transportation to cover more ground efficiently.
                                        Budget: $${Math.min(dailyBudget * 0.3, 50).toFixed(0)} for transportation and entrance fees.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">2:00 PM - 5:00 PM</div>
                                    <div class="activity-title">Local Experiences</div>
                                    <div class="activity-description">
                                        Engage in activities that showcase the unique character of the destination. 
                                        This could include local tours, workshops, or recreational activities.
                                        Budget: $${Math.min(dailyBudget * 0.4, 70).toFixed(0)} for activities and experiences.
                                    </div>
                                </div>
                                <div class="activity">
                                    <div class="activity-time">7:00 PM - 9:00 PM</div>
                                    <div class="activity-title">Evening Leisure</div>
                                    <div class="activity-description">
                                        Enjoy the evening atmosphere with dinner at a local restaurant and perhaps 
                                        some evening entertainment or a leisurely stroll through popular areas.
                                        Budget: $${Math.min(dailyBudget * 0.3, 45).toFixed(0)} for dinner and entertainment.
                                    </div>
                                </div>
                            `;
                    }
                }

                plan += `
                    <div class="plan-day">
                        <h3>Day ${day} - ${dateStr}</h3>
                        ${dayActivities}
                        <div style="margin-top: 15px; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 6px;">
                            <strong>Daily Budget Allocation:</strong> $${dailyBudget.toFixed(0)} 
                            ${day === 1 || day === days ? '(includes transport costs)' : '(accommodation, food, activities)'}
                        </div>
                    </div>
                `;
            }

            // Add travel tips
            plan += `
                <div class="plan-day" style="border-left-color: #28a745;">
                    <h3><i class="fas fa-lightbulb"></i> Essential Travel Tips</h3>
                    <div class="activity">
                        <div class="activity-title">Budget Management</div>
                        <div class="activity-description">
                            • Keep 10-15% of your budget as emergency funds<br>
                            • Use local payment methods when possible for better rates<br>
                            • Track daily expenses to stay within budget<br>
                            • Look for combo deals and group discounts
                        </div>
                    </div>
                    <div class="activity">
                        <div class="activity-title">Safety & Health</div>
                        <div class="activity-description">
                            • Keep copies of important documents in separate locations<br>
                            • Share your itinerary with someone at home<br>
                            • Research local emergency numbers and hospital locations<br>
                            • Stay hydrated and be mindful of local food safety
                        </div>
                    </div>
                    <div class="activity">
                        <div class="activity-title">Cultural Etiquette</div>
                        <div class="activity-description">
                            • Research local customs and dress codes<br>
                            • Learn basic phrases in the local language<br>
                            • Respect photography restrictions at cultural sites<br>
                            • Tip according to local customs and expectations
                        </div>
                    </div>
                </div>
            `;

            return plan;
        }

        // Handle form submission
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const generateBtn = document.getElementById('generateBtn');
            const originalText = generateBtn.innerHTML;
            
            try {
                // Clear previous errors
                const existingError = document.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }

                // Show loading state
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Your Perfect Trip...';

                // Get form data
                const formData = {
                    origin: document.getElementById('origin').value.trim(),
                    destination: document.getElementById('destination').value.trim(),
                    startDate: document.getElementById('startDate').value,
                    endDate: document.getElementById('endDate').value,
                    budget: parseFloat(document.getElementById('budget').value),
                    transport: document.getElementById('transport').value,
                    preferences: document.getElementById('preferences').value.trim()
                };

                // Validate all inputs
                if (!formData.origin || !formData.destination) {
                    throw new Error('Please enter both origin and destination');
                }

                if (!formData.startDate || !formData.endDate) {
                    throw new Error('Please select both start and end dates');
                }

                if (!formData.transport) {
                    throw new Error('Please select a transport mode');
                }

                if (!selectedMood) {
                    throw new Error('Please select your travel mood');
                }

                // Validate dates and get trip duration
                const days = validateDates();
                
                // Validate budget
                validateBudget(formData.budget);

                // Update route on map
await updateRoute(formData.origin, formData.destination);

// First: get Gemini AI itinerary
const aiItinerary = await generateGeminiItinerary(formData);

// Next: get default fallback plan
const defaultPlan = await generateDetailedTravelPlan(formData, days);

const combinedPlan = `
    <div class="ai-itinerary" style="margin-bottom:30px; padding:20px; border-radius:10px; background:#f8f9ff;">
        <h3 style="color:#6a4cff; margin-top:0;">✨ AI-Powered Itinerary</h3>
        <div>${markdownToHtml(aiItinerary)}</div>
        
        <!-- Toolbar appears right after AI plan -->
        <div id="aiPlanToolbar" style="display:none; margin-top:15px; text-align:center;">
          <button class="ai-toolbar-btn" onclick="listenPlan()">🔊 Listen</button>
          <button class="ai-toolbar-btn" onclick="printPlan()">🖨️ Print</button>
          <button class="ai-toolbar-btn" onclick="savePlan()">💾 Save</button>
          <button class="ai-toolbar-btn" onclick="mapView()">🗺️ Map View</button>
        </div>
    </div>

    <div style="margin-top:20px; padding:15px; border-left:4px solid #667eea; background:#f8f9ff;">
        <h3>📌 Default Overview (Guidance)</h3>
        ${defaultPlan}
    </div>
`;

        // Display both
        document.getElementById('planContent').innerHTML = combinedPlan;
        document.getElementById('travelPlan').style.display = 'block';
        onPlanGenerated();

                // Scroll to plan
                document.getElementById('travelPlan').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });

                console.log('Travel plan generated successfully');

            } catch (error) {
                console.error('Form submission error:', error);
                showError(error.message);
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = originalText;
            }
        }
        function savePlan() {
    const title = document.getElementById('origin').value + " → " + document.getElementById('destination').value;
    const dates = document.getElementById('startDate').value + " - " + document.getElementById('endDate').value;
    const planContent = document.getElementById('planContent').innerHTML;

    const tripData = {
        title: title,
        dates: dates,
        status: 'Upcoming',
        statusClass: 'status-upcoming',
        destinations: [document.getElementById('destination').value],
        planTitle: "Trip Plan",
        planContent: planContent
    };

    // Save to localStorage under "saved"
    let trips = JSON.parse(localStorage.getItem('userTrips') || '{}');
    if (!trips.saved) trips.saved = [];
    trips.saved.push(tripData);
    localStorage.setItem('userTrips', JSON.stringify(trips));

    alert("Trip saved! Go to My Trips to view.");
}



        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing TripMate application');
            
            initMap();
            setMinDate();
            handleMoodSelection();
            
            // Add form submit handler
            document.getElementById('travelForm').addEventListener('submit', handleFormSubmit);
            
            // Update end date minimum when start date changes
            document.getElementById('startDate').addEventListener('change', function() {
                document.getElementById('endDate').min = this.value;
            });

            console.log('TripMate initialization complete');
        });

        // Toggle other services dropdown
        document.getElementById('toggle-services-btn').addEventListener('click', function() {
            const dropdown = document.getElementById('services-dropdown');
            dropdown.classList.toggle('active');
        });
        
        document.getElementById('other-services-btn').addEventListener('click', function(e) {
            e.preventDefault();
            const dropdown = document.getElementById('other-services-dropdown');
            dropdown.classList.toggle('active');
        });
        
        // User dropdown functionality
        document.querySelector('.user-icon').addEventListener('click', function() {
            const dropdown = document.querySelector('.dropdown-content');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
        
        // Close dropdown when clicking outside
        window.addEventListener('click', function(e) {
            if (!e.target.matches('.user-icon') && !e.target.matches('.user-icon *')) {
                document.querySelector('.dropdown-content').style.display = 'none';
            }
        });
        
        // Booking dropdown functionality
        document.querySelector('.booking-btn').addEventListener('click', function() {
            const dropdown = document.querySelector('.booking-content');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
        
        // Set default dates
        const today = new Date();
        const nextWeek = new Date(today);
        nextWeek.setDate(today.getDate() + 7);
        
        document.getElementById('start-date').valueAsDate = today;
        document.getElementById('end-date').valueAsDate = nextWeek;

        // Listen with text-to-speech
function listenPlan() {
  const planText = document.getElementById('planContent').innerText;
  const speech = new SpeechSynthesisUtterance(planText);
  speech.lang = 'en-US';
  window.speechSynthesis.speak(speech);
}

// Print without clearing plan
function printPlan() {
  window.print();
}

// Save to localStorage
function savePlan() {
  const planHtml = document.getElementById('planContent').innerHTML;

  // Collect trip details from user inputs
  const origin = document.getElementById('origin').value || 'Unknown Origin';
  const destination = document.getElementById('destination').value || 'Unknown Destination';
  const startDate = document.getElementById('startDate').value || '';
  const endDate = document.getElementById('endDate').value || '';

  // Format trip title & dates
  const title = `${origin} → ${destination}`;
  const dates = startDate && endDate ? `${startDate} - ${endDate}` : 'Dates not set';

  // Determine category based on dates
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const start = new Date(startDate);
  const end = new Date(endDate);
  
  let category;
  if (end < today) {
    category = 'history';
  } else if (start > today) {
    category = 'saved';
  } else {
    category = 'current';
  }

  // Prepare new trip data in proper structure
const newTrip = {
    id: 'trip-' + Date.now(),
    title: title,
    dates: dates,
    status: category === 'history' ? 'Completed' :
            category === 'saved' ? 'Upcoming' : 'In Progress',
    statusClass: category === 'history' ? 'status-completed' :
                 category === 'saved' ? 'status-upcoming' : 'status-current',
    //destinations: ["static\images\paris.jpg"],   // can add more images later
    plan: {
        title: 'AI Travel Itinerary',
        content: planHtml
    }
};

 // Load existing trips
let trips = JSON.parse(localStorage.getItem('userTrips')) || { saved: [], current: [], history: [] };

// Push into the correct category
trips[category].push(newTrip);
localStorage.setItem('userTrips', JSON.stringify(trips));

alert("✅ Trip saved! It will appear in your " + category + " trips.");


}


// Jump to map card
function mapView() {
  document.getElementById('map').scrollIntoView({ behavior: 'smooth' });
}


function onPlanGenerated() {
  // Show toolbar only for AI plan
  document.getElementById('aiPlanToolbar').style.display = 'block';
  
}
    </script>
</body>
</html>